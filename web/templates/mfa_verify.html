{% extends "base.html" %}
{% block title %}Verificação MFA - Landlord{% endblock %}
{% block content %}
<div class="login-wrap">
    <div class="panel login-panel">
        <div class="panel-body" style="padding: 2rem;">
            <h2 class="login-title">Verificação MFA</h2>
            <p class="text-muted" style="margin-bottom: 1.5rem;">Digite o código do seu aplicativo autenticador.</p>

            {% if error %}
            <div class="toast toast--danger" role="alert">{{ error }}</div>
            {% endif %}

            <form method="post" action="/mfa-verify" id="totp-form">
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                <div class="field">
                    <label for="code" class="field-label">Código de autenticação</label>
                    <input type="text" class="field-input" id="code" name="code"
                           autocomplete="one-time-code" inputmode="numeric"
                           maxlength="8" required autofocus
                           placeholder="000000">
                </div>
                <input type="hidden" name="method" value="totp">
                <button type="submit" class="btn btn--primary" style="width: 100%;">Verificar</button>
            </form>

            {% if has_passkeys %}
            <hr style="margin: 1.5rem 0; border-color: var(--ink-10);">
            <button id="passkey-btn" class="btn" style="width: 100%;">Usar Passkey</button>
            {% endif %}

            <details style="margin-top: 1.5rem;">
                <summary style="cursor: pointer; font-size: 0.9rem; color: var(--ink-50);">Usar código de recuperação</summary>
                <form method="post" action="/mfa-verify" style="margin-top: 0.75rem;">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                    <div class="field">
                        <input type="text" class="field-input" name="code" placeholder="Código de recuperação">
                    </div>
                    <input type="hidden" name="method" value="recovery">
                    <button type="submit" class="btn btn--sm" style="width: 100%;">Verificar com código de recuperação</button>
                </form>
            </details>
        </div>
    </div>
</div>
{% endblock %}
{% block scripts %}
{% if has_passkeys %}
<script src="{{ url_for('static', path='core/js/webauthn.js') }}?v={{ asset_version }}"></script>
<script>
document.getElementById('passkey-btn').addEventListener('click', function() {
    webauthnAuthenticate('/security/passkeys/auth/begin', '/security/passkeys/auth/complete');
});
</script>
{% endif %}
{% endblock %}
