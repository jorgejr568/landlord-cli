{% extends "base.html" %}
{% block title %}Configurar TOTP - Landlord{% endblock %}
{% block content %}
<div class="page-header">
    <div class="page-header-info">
        <h2 class="page-title">Configurar Autenticação TOTP</h2>
        <p class="page-subtitle">Escaneie o QR code com seu aplicativo autenticador.</p>
    </div>
</div>

{% if mfa_setup_required %}
<div class="mfa-enforcement-banner">
    Sua organização exige autenticação multifator. Configure o TOTP ou uma passkey para continuar.
</div>
{% endif %}

<div class="panel">
    <div class="panel-head"><h5>1. Escaneie o QR Code</h5></div>
    <div class="panel-body">
        <p>Abra seu aplicativo autenticador (Google Authenticator, Authy, etc.) e escaneie o código abaixo:</p>
        <div class="qr-code-wrap">
            <img src="data:image/png;base64,{{ qr_base64 }}" alt="QR Code TOTP" width="250" height="250">
        </div>
        <details style="margin-top: 1rem;">
            <summary style="cursor: pointer; font-size: 0.9rem; color: var(--ink-50);">Inserir manualmente</summary>
            <p style="margin-top: 0.5rem;">Use esta chave no seu aplicativo:</p>
            <div class="secret-key">{{ secret }}</div>
        </details>
    </div>
</div>

<div class="panel">
    <div class="panel-head"><h5>2. Confirme o código</h5></div>
    <div class="panel-body">
        <p>Após escanear, digite o código de 6 dígitos exibido no aplicativo:</p>
        <form method="post" action="/security/totp/confirm" style="margin-top: 1rem;">
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
            <div class="field" style="max-width: 280px;">
                <label for="code" class="field-label">Código de verificação</label>
                <input type="text" class="field-input" id="code" name="code"
                       autocomplete="one-time-code" inputmode="numeric"
                       maxlength="6" required autofocus
                       placeholder="000000">
            </div>
            <button type="submit" class="btn btn--primary">Confirmar e Ativar</button>
        </form>
    </div>
</div>

{% if mfa_setup_required %}
<p style="margin-top: 1rem;">
    <a href="/security" class="btn btn--sm">Ou cadastrar uma Passkey</a>
</p>
{% endif %}
{% endblock %}
